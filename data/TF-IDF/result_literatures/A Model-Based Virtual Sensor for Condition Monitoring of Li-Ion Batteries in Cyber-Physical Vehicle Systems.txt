A model-based virtual sensor for assessing the health of rechargeable batteries for cyber-physical vehicle systems (CPVSs) is presented that can exploit coarse data streamed from on-vehicle sensors of current, voltage, and temperature. First-principle-based models are combined with knowledge acquired from data in a semiphysical arrangement. The dynamic behaviour of the battery is embodied in the parametric definition of a set of differential equations, and fuzzy knowledge bases are embedded as nonlinearblocks in these equations, providing a human understandable reading of the State of Health of the CPVS that can be easily integrated in the fleet through-life management.
Cyber-physical vehicle systems (CPVSs) integrate locomotion, computational, and communication components, aiming to leverage interdependent behaviour by integrating control, computing, communications, and physical systems.
Monitoring, fault detection, and diagnosis of CPVSs are achieved through a combination of hardware sensors and decision-making software [2], often by “anytime” or“imprecise computing” algorithms that balance resources and performance, refining the solutions when the resources become available [3] or degrading gracefully with reduced cyber resources [4].
Energy management algorithms for CPVS fleets should take into account the fact that the batteries in the vehicles are in different health conditions.
In this paper it is proposed that a virtual sensor (soft sensor) of the SoH is developed that combines signals already present in the BMS and also makes use of a battery model for synthesizing a “health signal” that is sent to the supervisor if an incipient degradation is detected.
Certain “first-principles” (electrochemical) models can estimate health-related variables taking current, voltage, and temperature as inputs [6].
By “grey-box” it is meant that the model is learnt from data, but at the same time it depends on physically meaningful parameters of the battery. The virtual sensor introduced in the present contribution is based on an “imprecise computing” model that exploits unreliable data streamed from on-vehicle sensors of current, voltage, and temperature. Parts of the proposed sensor are implemented with Fuzzy Rule-Based Systems (FRBS) that are fitted to operational data with Genetic Fuzzy Systems (GFSs).
The best reported methods for assessing battery health compute the functional dependence between the stored charge and the open circuit voltage (OCV) of the battery at equilibrium, by determining the positions of the peaks at the Incremental Capacity (ICA) [7].
A balance between white and black boxes is needed, and these are the“grey boxes,” also known as “semiphysical models.”
The most prevalent grey boxes are equivalent circuit models, where the battery is assimilated to an electrical circuit comprising a network of resistances and capacitors.
Other kinds of grey boxes have been successfully used in State of Charge (SoC) predictive models [22, 23], and these can be adapted to the problem at hand with certain modifications. These models are based on a physical analogy between charging a battery and filling a flexible vessel, because the function linking the height of a fluid with its mass, in a vessel with the appropriate shape, can also measure the interdependence between the voltage of a battery and its charge.
In this section, a design of an ensemble of Fuzzy RuleBased Systems (FRBS) and differential equations is presented.
A black-box model is possible but it would require a long time window and training data covering many different scenarios, which is not always available (or attainable).
There is a dotted input in the diagram, indicating that the OCV should also depend on the battery temperature, but this dependence can be safely ignored for LiFePO4 batteries.
The third FRBS models the heat emission of the battery as a function of the SoC and the charging current. The output of this system is not routed to the exterior either, but it is the input of an internal dynamical model of the temperature of the battery that depends on the specific heat of the cell and the thermal resistance between the cooling system and the ambient.
There are energy losses and, to a lesser degree, charging losses that are handled by multiplying the input current by a factor (about 0.999 in this study; this is the “charging losses” box).
The absolute value is needed because the current is negative when discharging. In this model the simplification PV(SoC, 𝐼) ≈ 𝑘 ⋅ 𝐼 is made, for a constant 𝑘 that is learnt from data; thus the nonreversible energy losses are proportional to the square of the current.
According to our experimentation, a first-order differential equation or exponential decay with time constant 𝜏 is enough to acknowledge this constraint: 𝜏 ⋅ ̇ OP = −OP +𝐼⋅ FRBS2 (SoC, 𝑇,sign (𝐼)) .
The forcing function is 𝐼 ⋅ FRBS2(SoC, 𝑇,sign(𝐼)), where FRBS2 can be understood as a charge-dependant impedance that models the linearized quotient between overpotential and current. If the current is 0, OP eventually also becomes 0, modelling the voltage relaxation mentioned before. Small batteries have low 𝜏, that is, quick dynamics and vice versa.
 It is proposed that the dynamic properties of the battery temperature are approximated by this equation: 𝑐 ⋅ ̇ 𝑇 = −𝜌 (𝑇 − 𝑇amb) + |𝐼 ⋅ OP| + 𝐼2 [𝑘 + 𝑇 ⋅ FRBS3 (SoC,sign (𝐼))] ,
The tested cell is a LiFePO4 (LFP) pouch battery from European Batteries (see Figure 3). This cell uses a LFP cathode in combination with graphite anode active material.
A novel model-based soft sensor for fault detection and diagnosis of rechargeable batteries for CPVSs has been proposed. The main contribution of the present work is the implementation of an “imprecise computing,”  learning semiphysical model of a battery.
The proposed model contains three learnable FRBSs, connected with different dynamical blocks, in a setup that allows obtaining certain parameters of the underlying physical process that are costly or hard to estimate with a dedicated experiment.
In future works, the first-order assumption for the dynamics of the overpotential will be dropped and replaced by a fractional-order differential equations model. Also, it is remarked that the experiments have been made in an off-vehicle temperature controlled environment. Further experiments are needed where the battery temperature is subjected to larger changes for different use patterns.
