Invariant learning based multi-stage identiﬁcationfor Lithium-ion battery performance degradation
Abstract—By informing accurate performance (e.g., capacity),health state management plays a signiﬁcant role in safeguard-ing battery and its powered system. While most current ap-proaches are primary based on data-driven methods, lacking in-depth analysis of battery performance degradation mechanismmay discount their performances. To ﬁll in the research gapabout data-driven battery performance degradation analysis,an invariant-learning based method is proposed to investigatewhether the battery performance degradation follows a ﬁxedbehavior. First, to unfold the hidden dynamics of cycling batterydata, measurements are reconstructed in phase subspace.
Next,a novel multi-stage division strategy is put forward to judge the existent of multiple degradation behaviors. Then the whole aging procedure is sequentially divided into several segments, among which cycling data with consistent degradation speed are assigned in the same stage. 
Simulations on a well-know benchmark verify the efﬁcacy of the proposed multi-stages identiﬁcation strategy.
The proposed method not only enables insights into degradation mechanism from data perspective, but also will be helpful to related topics, such as stage of health.
Index Terms—Li-ion batteries, phase division of health degra-dation, invariant learning, stationary subspace decomposition.
Ever-increasing stresses on environment protection and en-ergy supply raise growing spotlights on Lithium-ion battery(LiB), which is a kind of renewable energy storage and power source in comparison with traditional fuel. Characterized by high-energy density and falling cost [1], wide applications of LiB have been observed in various electronics and instruments.
Due to close connections between the health status of LiB and its powered systems, accurate evaluation and in-depth under-standing of performance degradation become indispensable to ensure and improve the performance of the whole system.
Resulting from performance degradation, battery capacity is adopted as an indicator to indicate battery health state via available amount, which will fade due to battery aging.
To distinguish from the capacity loss in calendar storage, in this article, capacity fade only refers to the “cycle life” loss in battery discharge ability over time. Related with complex physical and chemical mechanisms, performance degradation is a rather complex procedure. Besides, frequent usage and exposure to harsh environmental conditions will disturb the degradation speed. 
However, most literature on health state simply assume a single degradation behavior [2]-[4], which may not meet well with the real case.
Some literature pointed out the erratic behavior during capacity fading [5]-[8]. Spotnitz [5] found that the rate of capacity loss experiences initially high, then slows quickly, slows again, and ﬁnally rapidly decreases. Severson et al. [6] proposed a battery life prediction method before capacity degradation, indicating the recognition of different stages within a whole degradation procedure. 
To be more quan-titative, Dubarry et al. [7] attempted to investigate fading stages through Peukert ˛a´rs coefﬁcient. Furthermore, Yu [8] put forward a degradation stage identiﬁcation method using a distribution-based correlation index, which measured thesimilarity between the historic Gaussian components and thenew Gaussian components. In this way, a whole degradation stage was classiﬁed into a health state, slight degradation state, and severe degradation state by checking the value of the deﬁned index. 
However, selecting thresholds for these stages is manual and subjective, indicating the uncertainty of the results. Although these methods fail to give accurate identiﬁcation results, they succeed in conﬁrming the phe-nomenon of different degradation behavior. 
This phenomenon is named as multi-stage characteristic here. That is, a complete capacity fading may consist of several degradation behavior patterns, in which dynamics keeps consistent in the same pattern, while is dissimilar between different patterns. 
The consecutive discharging cycles in the same pattern form a degradation stage. The multi-stage identiﬁcation will not only improve in-depth analysis of degradation mechanisms but also may contribute to other related topics, such as state of health estimation.
In this article, an invariant-learning based sequential stage division method is proposed, which is capable of providing reliable and unique results. The invariant is designed with the characteristics that it is statistically consistent in the same stage while it is different across stages. That is, they are sensitive to the changes in degradation speed. As a result, the identiﬁcation of different stages can be iteratively achieved by monitoring the changes of the invariants. 
The stationary subspace analysis (SSA) method, which is good at learning stationary compo-nents from non-stationary systems, is improved to extract this kind of invariants with equally arranged cycling data.
Through repetitively charging and discharging procedure, energy is continuously transferred from LiB to its powered system. The repetitive usage over cycles causes a natural drop of capacity as shown in Fig. 1, in which data are provided by Ames Prognostics Center of Excellence in National Aero- nautics and Space Administration (NASA) [9]. 
Capacity is the ability to evaluate available current that a battery can supply during a discharging cycle, which is usually recognized as the external performance indicator for LiB. In practice, for the cth discharging cycle, a two-dimensional data array Xc (J × Kc ) could be constructed with J variables sampled over Kc sample points. 
Kc usually decreases with the increase of cycles in response to the capacity loss. As a result, a three-dimensional data matrix X(N × J × Kc ) with uneven length is formed when the number of N discharging cycles are available as shown in Fig. 2.
First, dynamics hidden behind process variables are unfolded in the framework of phase subspace, yielding reconstructed data. Next, invariants indicat-ing degradation trend are decomposed by linear superposition of the reconstructed data, which are computed using cycling SSA. Third, the monitoring strategy on invariants is given, distinguishing degradation stages from each other. 
The general ﬂow of the proposed method is brieﬂy illustrated in Fig. 3.
Considering that capacity fading reﬂects the internal dynamics of measurements (i.e., voltage, current, and temperature in LiB), it is more rea-sonable to separate the whole degradation procedure according to the dynamical changes of these process variables. 
On the basis of this, the following considerations act as guidance: (1) Despite the largely continuous nature of the capacity fading, it is possible that there are more than one degradation behaviors caused by complex external and internal factors; (2) In each cycle that may exist features that are kept similar during the same degradation stage, while they are very  dissimilar at different degradation stages.
With these considerations, the issue of identiﬁcation degra-dation stages is equal to the problem of ﬁnding features that are sensitive to degradation changes. In this article, invariants across cycles are chosen as indicators and the speciﬁcs are illustration in the following parts.
A. Data Reconstruction in Multivariate Phase Subspace Phase subspace reconstruction (PSR) [9] originates from chaos theory, which aims to describe the underlying dynamics of a system by extending the low-dimension original mea-surements to a high-dimension embedding. 
This embedding ensures that hidden states are revealed through reconstruction without evolving of complex mechanisms. For a variable v = [v1 , v2 , ..., vL ] with the number of samples L, its reconstructed matrix is V = [v1 , v2 , ..., vr ] in phase space, which is achieved via delay stacked below, where τ is time lag and r is the embedding dimension.
To solve stationary source Ss , Kullback-Leibler divergence (KLD) [14] is employed to measure the distributions between Ss and Gaussian distribution with zero mean and unit variance. Correspondingly, Bs corresponding to minimal KLD is the optimal. In this way, the purpose of solving stationary source equals to ﬁnding the optimal Bs .
2) Cycling SSA for learning invariants: The input of tradi-tional SSA is continuous multivariate time series, which needs to be equally divided into several epochs to derive Bs . To meet with the cycling characteristic of LiB data, a cycling SSA with PSR is speciﬁed below:
Taking C discharging cycles as input data. Performing multivariate PSR given in Subsection III.A to each cycling data. Denoting the reconstructed data as X1 , X2 , to XC corresponding to Cycles 1 to C .
To meet with the precondition of equal length of epoches, a minimum length M among all cycles is selected. By remaining the ﬁrst M samples in each matrix, the cycling data are synchronized to the same length. For brevity, the synchronized matrixes are still denoted as X1 , X2 , ..., XC .
The mean and variance of Xi (i ∈ [1, C ]) can be easily estimated as ui and Σi , respectively. Assuming B is available, perform linear transformation s = BWXT on each cycle. 
The mean and variance of the ith cycle after transformation are is the identity matrix I(J × J ) truncated to the ﬁrst d rows. In this way, solving Eq. (3) is transformed to an optimization problem by minimizing the objective function below, the mean and variance after linear transformation, respectively;
DKL () is the KLD function; N (0, I) is the Gaussian dis-tribution with zero mean and unit variance; Pi,s (m) is the probability density of N ( ˜ui,s , Σi,s ) for the mth sample; Q(m) is the probability density of N (0, I) for the mth sample.
r determines the dimensions of reconstructed space, which can be computed using the false neighbor method [10]. A proper τ is determined when mutual information between x, and its lagged vector is minimal [11]. More speciﬁcs about the calculation of τ and r can be found in [12].
For multivariate time series with variable dimension J , reconstructed data matrixes are obtained by performing PSR on each variable. Noting the reconstructed matrixes as V1 , V2 , ..., VJ corresponding to each variable, respectively.
Since the varying values of τ and r of each variable, the dimensions of V1 , V2 , ..., VJ may be different, resulting a dif- ﬁculty to merge these matrixes directly. Here, the maximum of τ among variables is employed to keep low correlations. 
And the maximum of r among variables is selected to extend the variable dimension as many as possible. The integrated matrix with variable dimension J r is noted as V = [V1 , V2 , ..., VJ ].
Although many practical systems (e.g., stock market, geo-physics) appear seriously non-stationary, they are possibly the superposition of stationary and non-stationary sources. That is, there may be invariant in dynamical system, which is the behind idea of SSA [13]. 
Motivated by this, SSA is employed to learn invariants from LiB discharging procedure, which possesses the non-stationary characteristics.
1) Brief review of SSA: For a set of non-stationary multi-variate time series V, it can be presented by a linear combi-nations of d stationary source signals Ss = [s1 , s2 , ..., sd ] and J r−d non-stationary source signals Sns = [sd+1 , sd+2 , ..., sJ ] as follows,
where Ts is the principal component (PC) matrix; Ps is the stage loading matrix retaining all PCs.
In fact, most of process variations in Ts are contained in the ﬁrst several PCs. The retained number of PCs R can be determined by the cumulative explained variance rate [14] to keep most of the process variability (85% here). Monitoring statistics Hoteling-T 2 (threshold) is designed to monitor the normal variation of Ts , which can be approximated by an F distribution [14] as follows,
In this section, the proposed multi-stage identiﬁcation ap-proach is veriﬁed with a well-known benchmark for LiB study. This benchmark is released by NASA . Four battery datasets that have been widely used in many previous researches [2]-[4] are employed. The speciﬁcs of these datasets are described in Table I. Due to page limitation, only B0005 is carefully analyzed to illustrate performances with respect to data reconstruction, invariant learning, and the degradation stage division. Besides, division results of degradation stage for other batteries are shown.
A. Multivariate PSR Reconstruction
B. Invariants using Cycling SSA
According to the selection strategy given in Section III.B, three stationary sources are retained using ADF test, which could indicate the stationary of a variable by judging the existence of unit root. Fig. 5 visualizes these stationary sources, which present invariant across cycles. This proves that inferences that there may be consistent dynamics over cycles 
C. Identiﬁcation of Degradation Stages
Iteratively perform cycling SSA method on the remaining cycling data. Based on the obtained stationary subspace, invariants in these cycles are obtained. In Fig. 6, different degradation behaviors are observed at the 27th cycle, where the rate of false classiﬁcation rises rapidly and above the normal level ever since. Therefore, the cycles from
In addition to battery B0005, another three batteries are analyzed according to the same procedure. The details are omitted for brevity. By reviewing the results, several phenomena can be easily observed. First, B0006 has a very similar evolving trend with B0005, presenting the number of stages and cycles. Second, the battery with the same material may have very different degradation behavior.
To probe into the degradation mechanism of LiB from data-driven perspective, this article puts forward a multi-stage division for the ﬁrst time in improving process insights. In-depth analysis is achieved through three main parts, including data reconstruction in phase subspace, invariant learning with improved cycling stationary subspace analysis, and a stage division strategy. According to the simulation results, implicit dynamics could be unfolded with data reconstruction, indicat- ing the evolution of sequential cycling data. Invariants could be effectively learned and used for indication of degradation switch. Additionally, it would be interesting to apply this idea for other topics, such as state of health estimation, and better performances may be achieved.



